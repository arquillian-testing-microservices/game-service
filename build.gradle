buildscript {
    repositories {
        jcenter()
    }

    dependencies {
        classpath 'com.bmuschko:gradle-docker-plugin:3.0.3'
    }
}

plugins {
    id "io.spring.dependency-management" version "0.6.1.RELEASE"
}

apply plugin: 'war'

allprojects {
    group = 'org.arquillian.microservices'
    version = '1.0.0-SNAPSHOT'

    sourceCompatibility = 1.8
    targetCompatibility = 1.8

    repositories {
        mavenCentral()
    }
}

dependencies {
    providedCompile 'javax:javaee-api:7.0'
    compile 'org.apache.deltaspike.core:deltaspike-core-api'
    runtime 'org.apache.deltaspike.core:deltaspike-core-impl'
}

dependencyManagement {
    imports {
        mavenBom 'org.apache.deltaspike.distribution:distributions-bom:1.7.1'
    }
}

war {
    archiveName 'game-service.war'
}

apply plugin: 'com.bmuschko.docker-remote-api'
import com.bmuschko.gradle.docker.tasks.image.DockerBuildImage

docker {
    if (System.env.containsKey('DOCKER_HOST') && System.env.containsKey('DOCKER_CERT_PATH')) {
        url = System.env.DOCKER_HOST.replace("tcp", "https")
        certPath = new File(System.env.DOCKER_CERT_PATH)
    }
}

task buildImage(type: DockerBuildImage) {
    dependsOn assemble
    inputDir = project.rootDir
    tag = "arquillian/game-service:${project.version}"
}